# [RastreioBot](http://telegram.me/RastreioBot)

[![Build Status](https://travis-ci.org/GabrielRF/RastreioBot.svg?branch=master)](https://travis-ci.org/GabrielRF/RastreioBot)
[![Donate](https://img.shields.io/static/v1?label=Assine&message=PicPay&color=green)](https://grf.xyz/assine)
[![Donate](https://img.shields.io/static/v1?label=Colabore&message=PicPay&color=brightgreen)](https://grf.xyz/picpay)
[![Twitter Follow](https://img.shields.io/twitter/follow/espadrine.svg?style=social&label=Follow)](https://twitter.com/gabrf)

![Rastreiobot](https://github.com/GabrielRF/RastreioBot/blob/master/imgs/rastreiobot.png?raw=true)

* [About](#about)
* [Setup](#setup)
* [Run](#run)
* [Contribute](#contribute)
* [Contact](#contact)

## About

This is a [Telegram](http://telegram.org) Bot that tracks packages from the [Brazilian Mail Service](https://www.correios.com.br/). It runs on Python 3 and uses MongoDB.

[Try it!](http://telegram.me/RastreioBot)

## Setup

We use [Poetry](https://python-poetry.org/) to manage our dependencies. Check out its [Poetry guide](https://python-poetry.org/docs/#installation) to install it on your machine.

To install the required packages, use the command below. It will install the runtime and also the development dependencies (e.g. Pytest).

```
$ poetry install
```

Create a file `bot.conf` following `bot.conf_sample`.

`TOKEN` Bot token generated by BotFather

`int_check` Minimum interval between checks for the same package (3600 means 1 hour)

`*_log` Log files

`patreon` List of people that donate to the bot

`Banned` List of banned users

`usuario` User provived by Correios

`senha` Password provided by Correios

`token` Token provided by Correios

`key` Key provided by TrackingMore

`url` Sentry URL

### MongoDB

__RaspberryPi__
```
https://github.com/GabrielRF/Docker-MongoDB-RPi
```
__Mac__

```
brew install mongodb-community
brew services start mongodb-community
```

### SQLite


```
touch data_base.db
```

create db structure
```
CREATE TABLE assinantes (
        id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
        chatid TEXT,
        picpayid TEXT);
```

## Run

To receive messages:

```
poetry run python rastreiobot.py
```

To check for updates, I recommend a cronjob that runs every 15 min.

Type `crontab -e` and add to the end of the file:

```
*/15 * * * * cd /usr/local/bin/RastreioBot; /usr/bin/python3 /usr/local/bin/RastreioBot/routine.py 0
*/15 * * * * cd /usr/local/bin/RastreioBot; /usr/bin/python3 /usr/local/bin/RastreioBot/routine.py 1
*/15 * * * * cd /usr/local/bin/RastreioBot; /usr/bin/python3 /usr/local/bin/RastreioBot/routine.py 2
*/15 * * * * cd /usr/local/bin/RastreioBot; /usr/bin/python3 /usr/local/bin/RastreioBot/routine.py 3
...
```

## Running tests

The tests are running on `pytest`, so, in order to run them, just do

```
poetry run pytest
```

## Contribute

Pull requests and issues are welcome!

## Contact

[Telegram](http://telegram.me/GabrielRF)

[Site](http://www.gabrf.com)
